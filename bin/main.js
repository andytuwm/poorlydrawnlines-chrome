window.onload=function(){setTimeout(function(){function a(){v=this.response.title.replace(/Poorly Drawn Lines(\s\W\s)/i,""),document.getElementById("comicTitle").innerHTML=v,document.getElementById("comic").src=this.response.querySelector("#post img").src,document.getElementById("comic").title=v,j(y)}function b(){s=this.response.querySelector("#content > ul").children,q=0,r=s.length-1,t=s[0].firstChild.href,u=s[r].firstChild.href,c(t),document.getElementById("end").dismiss}function c(b){w=b;var c=new XMLHttpRequest;c.responseType="document",c.onload=a,c.open("GET",b,!0),c.send()}function d(){q!=r?(q=r,c(u)):document.getElementById("end").show()}function e(){r>=q+1?(q+=1,c(n(q))):document.getElementById("end").show()}function f(){q=Math.floor(Math.random()*r),c(n(q))}function g(){q-1>=0?(q-=1,c(n(q))):document.getElementById("end").show()}function h(){0!==q?(q=0,c(t)):document.getElementById("end").show()}function i(){chrome.tabs.create({url:w,active:!1})}function j(a){var b=v,c={com:q,disp:b};if(l(a,q)){var d=m(a,q);if(d>-1){var e=a.splice(d,1);a.push(e[0])}else console.error("Error: Index should always be found if comic was found in history.")}else a.length<10?a.push(c):(a.shift(),a.push(c)),x.historyList=a;chrome.storage.sync.set({browsed:a},function(){})}function k(){var a=F.selectedIndex;q=y[a].com,c(n(q)),F.selected=null}function l(a,b){for(var c=0;c<a.length;c++)if(a[c].com==b)return!0;return!1}function m(a,b){for(var c=0;c<a.length;c++)if(a[c].com==b)return c;return-1}function n(a){return s[a].firstChild.href}function o(){document.getElementById("404").show()}var p=new XMLHttpRequest,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=document.getElementById("array"),y=[];chrome.storage.sync.get("browsed",function(a){y=a.browsed,x.historyList=y}),p.responseType="document",p.onload=b,p.open("GET","http://poorlydrawnlines.com/archive/",!0),p.send();var z=document.getElementById("first"),A=document.getElementById("prev"),B=document.getElementById("random"),C=document.getElementById("next"),D=document.getElementById("last"),E=document.getElementById("comic"),F=(document.getElementById("explain"),document.getElementById("historyMenu")),G=document.getElementById("comic");z.onload=z.addEventListener("click",d,!1),A.onload=A.addEventListener("click",e,!1),B.onload=B.addEventListener("click",f,!1),C.onload=C.addEventListener("click",g,!1),D.onload=D.addEventListener("click",h,!1),E.onload=E.addEventListener("click",i,!1),F.onload=F.addEventListener("core-activate",k,!1),G.onerror=o},100)};