window.onload=function(){"use strict";function a(){y=this.response.title.replace(/Poorly Drawn Lines(\s\W\s)/i,"");var a=u-t;document.getElementById("comicTitle").innerHTML=y,document.getElementById("comicNumber").innerHTML="#"+a,J.src="",J.src=this.response.querySelector(".post img").src,J.title=y,k(D),J.style.opacity=1,document.querySelector(".mdl-spinner").classList.remove("is-active"),A&&(document.getElementById("image").scrollTop=0)}function b(){v=this.response.querySelector(".content > ul").children,t=0,u=v.length-1,w=v[0].firstChild.href,x=v[u].firstChild.href,new Promise(function(a){c(w),J.onload=function(){a()}}).then(function(){N.style.WebkitAnimation="fadeIn 0.5s ease-in 1 forwards"})}function c(b){J.style.opacity=0,document.querySelector(".mdl-spinner").classList.add("is-active"),z=b;var c=new XMLHttpRequest;c.responseType="document",c.onload=a,c.open("GET",b,!0),c.send()}function d(){t!==u&&(t=u,c(x))}function e(){u>=t+1&&(t+=1,c(p(t)))}function f(){1===B?(G.style.WebkitAnimation="fullSpin 0.7s ease-out",B++):(G.style.WebkitAnimation="fullSpin2 0.7s ease-out",B--),t=Math.floor(Math.random()*u),c(p(t))}function g(){t-1>=0&&(t-=1,c(p(t)))}function h(){0!==t&&(t=0,c(w))}function i(){if(13===window.event.keyCode){var a=K.value;a.match(/[a-z]/i)||!a.match(/[0-9]+/)||u-a===t||a>=0&&u>=a&&(t=u-a,c(p(t))),K.value=""}}function j(){chrome.tabs.create({url:z,active:!1})}function k(a){var b=y,c={com:t,disp:b};if(m(a,t)){var d=o(a,t);if(d>-1){var e=a.splice(d,1);a.push(e[0])}else console.error("Error: Index should always be found if comic was found in history.")}else a.length<10?a.push(c):(a.shift(),a.push(c)),D=a;chrome.storage.sync.set({browsed:a},function(){C=!0})}function l(){var a=event.target.dataset.indexcount;t=D[a].com,c(p(t))}function m(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].com==b)return!0;return!1}function n(){if(C&&D.length>0){var a,b=document.getElementById("histList"),c=document.createElement("div");c.id="histList";for(var d=0;d<D.length;d++)a=document.createElement("li"),a.classList.add("mdl-menu__item"),a.innerHTML=D[d].disp,a.setAttribute("data-indexcount",d),c.appendChild(a);document.getElementById("historyMenu").replaceChild(c,b),C=!1}}function o(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].com==b)return c;return-1}function p(a){return v[a].firstChild.href}function q(){document.getElementById("404").show()}function r(){A?(document.getElementById("image").style.overflowY="hidden",J.style.maxHeight="450px",N.style.WebkitAnimation="spinBack 0.3s ease-in-out 1 forwards",A=!1):(document.getElementById("image").style.overflowY="scroll",J.style.maxHeight="none",N.style.WebkitAnimation="spin 0.3s ease-in-out 1 forwards",N.style.opacity="1",A=!0)}var s=new XMLHttpRequest,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=!1,B=1,C=!0,D=[];chrome.storage.sync.get("browsed",function(a){a.browsed&&(D=a.browsed,n())}),s.responseType="document",s.onload=b,s.open("GET","http://poorlydrawnlines.com/archive/",!0),s.send();var E=document.getElementById("first"),F=document.getElementById("prev"),G=document.getElementById("random"),H=document.getElementById("next"),I=document.getElementById("last"),J=document.getElementById("comic"),K=document.getElementById("searchinput"),L=document.getElementById("historyMenu"),M=document.getElementById("hist-button"),N=document.getElementById("expand");E.onload=E.addEventListener("click",d,!1),F.onload=F.addEventListener("click",e,!1),G.onload=G.addEventListener("click",f,!1),H.onload=H.addEventListener("click",g,!1),I.onload=I.addEventListener("click",h,!1),J.onload=J.addEventListener("click",j,!1),K.onload=K.addEventListener("keyup",i,!1),L.onload=L.addEventListener("click",l,!1),M.onload=M.addEventListener("click",n,!1),N.onload=N.addEventListener("click",r,!1),J.onerror=q};